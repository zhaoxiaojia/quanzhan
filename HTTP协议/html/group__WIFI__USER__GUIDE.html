<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACS: WiFi Manager User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACS
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__WIFI__USER__GUIDE.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">WiFi Manager User Guide<div class="ingroups"><a class="el" href="group__ACS__CORE__DOCS.html">ACS Core Docs</a> &raquo; <a class="el" href="group__USER__GUIDE.html">Middleware User Guides</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for WiFi Manager User Guide:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__WIFI__USER__GUIDE.png" border="0" alt="" usemap="#group____WIFI____USER____GUIDE"/>
<map name="group____WIFI____USER____GUIDE" id="group____WIFI____USER____GUIDE">
<area shape="rect" id="node2" href="group__USER__GUIDE.html" title="Middleware User Guides" alt="" coords="5,5,171,32"/>
</map>
</td></tr></table></center>
</div>
<p><b>Version Number:</b> 1.0</p>
<ul>
<li><a class="el" href="group__WIFI__USER__GUIDE.html#wifi_section_1">Introduction</a></li>
<li><a class="el" href="group__WIFI__USER__GUIDE.html#wifi_section_2">Dependencies</a></li>
<li><a class="el" href="group__WIFI__USER__GUIDE.html#wifi_section_3">Options</a></li>
<li><a class="el" href="group__WIFI__USER__GUIDE.html#wifi_section_4">Usage/Best Practices</a></li>
<li><a class="el" href="group__WIFI__USER__GUIDE.html#wifi_section_5">Build Artifacts</a></li>
<li><a class="el" href="group__WIFI__USER__GUIDE.html#wifi_section_6">References</a></li>
</ul>
<h1><a class="anchor" id="wifi_section_1"></a>
Introduction</h1>
<p>ACS WiFi Manager provides an API (<a class="el" href="group__ACE__WIFI.html">ACS Wifi Manager Middleware</a>) for client applications to interact with WiFi related components. Users of this API are able to create WiFi profiles, connect to WiFi networks, listen for network state change events and more. Applications can be built using this API to enable customers to connect their device to the internet via WiFi.</p>
<div class="image">
<img src="acs_wifi_mgr.png" alt="acs_wifi_mgr.png"/>
<div class="caption">
ACS WiFi Manager</div></div>
 <h1><a class="anchor" id="wifi_section_2"></a>
Dependencies</h1>
<p>ACS WiFi Manager middleware depends on the following modules:</p>
<ul>
<li>ACE_LOG</li>
<li><a class="el" href="group__OSAL.html">OSAL</a></li>
<li><a class="el" href="group__ACE__EVENTS.html">ACE EVENTS</a></li>
<li>ACE_METRIC</li>
<li>ACE_ACM</li>
<li>ATZ</li>
</ul>
<h1><a class="anchor" id="wifi_section_3"></a>
Options</h1>
<p>ACS WiFi Manager has many configurable options that can be used to enable and disable features, as well as help with memory constrained platforms:</p><ul>
<li><b>ACE_WIFI_MIDDLEWARE</b> Main option to enable ACS WiFi.</li>
<li><b>ACE_WIFI_INCLUDE_NETMGR</b> Including the ACS WiFi Network Manager will enable the captive portal test and ATZ options. The captive portal test is performed immediately after successful WiFi connections, and checks whether the network connection is behind a captive portal. The result of the test is published as an event that apps can register for with <a class="el" href="group__ACE__WIFI__API.html#ga5ed37e7d9308e05f5a03e00f6c6919ec">aceWifiMgr_registerCaptivePortalEvent</a>. Captive portals require users to enter additional login credentials to access the internet. Apps may use the test result to display the proper UI to login if needed. These options are also required for the captive portal test to function:<ul>
<li><b>ACE_CAPTIVE_PORTAL_HOST</b> The captive portal test involves opening an HTTP connection to a remote server and checking the http status response code. The host is the server hosting this test e.g. "example.com"</li>
<li><b>ACE_CAPTIVE_PORTAL_URL</b> The URL (path) that generates the expected http status response code e.g. "/generate_204". The captive portal test expects a 204 response, so if the status returned is a 204, internet connectivity is validated. Any other response is interpreted as a captive portal. WiFi access points that have a captive portal enabled typically respond to all HTTP requests with a 302 redirect to unauthorized users.</li>
</ul>
</li>
<li><b>ACE_WIFI_IEEE8021X</b> Enables support for IEEE 802.1X networks.</li>
<li><b>ACE_WIFI_ANT_DIV</b> Enables support for WiFi antenna diversity.</li>
<li><b>ACE_WIFI_MGR_TEST</b> Enables CLI integration tests.</li>
<li><b>ACE_WIFI_ATZ</b> Enables (Auto Time Zone) ATZ for WiFi country code support. Requires ACE_WIFI_INCLUDE_NETMGR to be enabled.</li>
<li><b>ACE_WIFI_PROFILE_UPDATE</b> Enables ability to update existing configured network profiles.</li>
<li><b>ACE_WIFI_PROFILE_EVENT</b> Enables configured network profile changes to be published as events and allows applications to register for those events.</li>
<li><b>ACE_WIFI_STATIC_IP</b> Enables support for static IP configurations. Users may add a network with their own custom IP address, gateway, network mask, and DNS.</li>
<li><b>ACE_WIFI_POWER_CONTROL</b> Enables support for WiFi power control if the platform HAL provides the feature.</li>
<li>Options that may help reduce the memory footprint of ACS WiFi Manager for more memory constrained platforms:<ul>
<li><b>ACE_WIFI_MAX_CONFIGURED_NETWORKS</b> Max number of configured network profiles that can be saved on the device.</li>
<li><b>ACE_WIFI_MAX_NUM_CB</b> Max number of callback clients allowed per process for each event type, e.g. network state events.</li>
<li><b>ACE_WIFI_MAX_SCAN_RESULTS</b> Max number of WiFi networks that can be returned in scan results. If there are no memory constraints, 200 is recommended to capture all available networks in a congested environment.</li>
<li><b>ACE_WIFI_NETMGR_STACK_SIZE</b> WiFi network manager stack size, RTOS only.</li>
<li><b>ACE_WIFI_SVC_STACK_SIZE</b> WiFi service stack size, RTOS only.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="wifi_section_4"></a>
Usage/Best Practices</h1>
<ul>
<li><b>Initializing ACS WiFi Manager API</b><br />
 All client applications that call ACS WiFi Manager APIs need to first initialize the API by calling <a class="el" href="group__ACE__WIFI__API.html#ga9b005db8002c62955fcd78daede0518b">aceWifiMgr_init</a>. This is required to verify that the ACS WiFi service is running and ready, and to initialize internal IPC if needed, depending on the platform. To clean up and exit, clients should call <a class="el" href="group__ACE__WIFI__API.html#ga8841e12bd1d3befc483eb871d246a533">aceWifiMgr_deinit</a>.</li>
<li><b>WiFi event callbacks</b><br />
 When registering a callback for ACS WiFi Manager events such as network state change events with <a class="el" href="group__ACE__WIFI__API.html#gaed21b3d3495720ecd9da650421680b60">aceWifiMgr_registerNetworkStateEvent()</a>, further calls to the ACS WiFi Manager API are not allowed inside the the callback function. This may cause undefined behavior and possibly deadlock or crash.</li>
</ul>
<h2><a class="anchor" id="autotoc_md70"></a>
Example 1 - Add a WiFi network profile and connect to it:</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ace/wifi_mgr.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// basic WPA2 WiFi configuration</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span>* test_ssid = <span class="stringliteral">&quot;test ssid&quot;</span>;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span>* test_pw = <span class="stringliteral">&quot;testPassword&quot;</span>;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group__ACE__WIFI__DEF.html#gae4f78712f5df3e3ecd0f3f0bbc3ff31b">aceWifiMgr_authMode_t</a> test_mode = <a class="code" href="group__ACE__WIFI__DEF.html#ggae4f78712f5df3e3ecd0f3f0bbc3ff31ba0b2a6d4fa66ff6892f15f5b68c817e68">aceWifiMgr_AUTH_WPA2</a>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> addWifiNetwork() {</div><div class="line">    <a class="code" href="structaceWifiMgr__config__t.html">aceWifiMgr_config_t</a> config = {0};</div><div class="line"></div><div class="line">    config.<a class="code" href="structaceWifiMgr__config__t.html#ada2655ce1f4b97e22e2cd0c571bd8aa9">ssidLength</a> = strlen(test_ssid);</div><div class="line">    strncpy(config.<a class="code" href="structaceWifiMgr__config__t.html#a60a8252cb78895337e330cda84d6e45a">ssid</a>, test_ssid, config.<a class="code" href="structaceWifiMgr__config__t.html#ada2655ce1f4b97e22e2cd0c571bd8aa9">ssidLength</a>);</div><div class="line"></div><div class="line">    config.<a class="code" href="structaceWifiMgr__config__t.html#a65bda0fbcfd18dfd9cbd41a030e35322">pskLength</a> = strlen(test_pw);</div><div class="line">    strncpy(config.<a class="code" href="structaceWifiMgr__config__t.html#adcf807e8ce1bbd998f03b8927cd9f478">psk</a>, test_pw, config.<a class="code" href="structaceWifiMgr__config__t.html#a65bda0fbcfd18dfd9cbd41a030e35322">pskLength</a>);</div><div class="line"></div><div class="line">    config.<a class="code" href="structaceWifiMgr__config__t.html#a896c611444d0f2f6f6221802ac07b973">authMode</a> = test_mode;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__ACE__WIFI__API.html#gaec27d7178aa23dac985e994d39c9b9e1">aceWifiMgr_addNetwork</a>(&amp;config) != <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a2654bea679a5df6320eb993c7377cd60">aceWifiMgr_ERROR_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to add WiFi network.&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> connectToWifi() {</div><div class="line">    <a class="code" href="group__ACE__WIFI__API.html#gac6a394a9c7e45a62a4474e79ef556d61">aceWifiMgr_connect</a>(test_ssid, test_mode);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__ACE__WIFI__API.html#ga9b005db8002c62955fcd78daede0518b">aceWifiMgr_init</a>() != <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a2654bea679a5df6320eb993c7377cd60">aceWifiMgr_ERROR_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to init ACS WiFi.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    addWifiNetwork();</div><div class="line"></div><div class="line">    connectToWifi();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__ACE__WIFI__API.html#ga8841e12bd1d3befc483eb871d246a533">aceWifiMgr_deinit</a>() != <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a2654bea679a5df6320eb993c7377cd60">aceWifiMgr_ERROR_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to deinit ACS WiFi.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md71"></a>
Example 2 - Register for scan events and print scan results:</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ace/wifi_mgr.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> scanEventCallback(<span class="keywordtype">void</span>* ctx) {</div><div class="line">    printf(<span class="stringliteral">&quot;scan done event received.\n&quot;</span>);</div><div class="line">    <span class="comment">// Note: do not make further ACS WiFi Manager API calls inside callbacks</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> printScanResults() {</div><div class="line">    <a class="code" href="group__ACE__WIFI__DEF.html#ga3b26ca0a8d9427744ef1b20351aa426d">aceWifiMgr_error_t</a> err = <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a8b8c2e5e8433910486adcd6c97e2aabb">aceWifiMgr_ERROR_UNKNOWN</a>;</div><div class="line">    <a class="code" href="structaceWifiMgr__scanResultList__t.html">aceWifiMgr_scanResultList_t</a> scanResultList = {0};</div><div class="line"></div><div class="line">    err = <a class="code" href="group__ACE__WIFI__API.html#ga48efed813d2c933a9874842a5fb6d87e">aceWifiMgr_getScanResults</a>(&amp;scanResultList);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (err != <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a2654bea679a5df6320eb993c7377cd60">aceWifiMgr_ERROR_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Error getting scan results: %d&quot;</span>, err);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Scan Results List:\n&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="structaceWifiMgr__scanResult__t.html">aceWifiMgr_scanResult_t</a>* result = NULL;</div><div class="line">    <span class="keywordtype">char</span> ssid[<a class="code" href="group__ACE__WIFI__DEF.html#gaa0911709c7e44717962b8d7e0adf99ea">MAX_SSID_LEN</a> + 1] = {0};</div><div class="line">    <span class="keywordtype">char</span> *authMode = NULL;</div><div class="line">    uint8_t i = 0;</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; scanResultList.<a class="code" href="structaceWifiMgr__scanResultList__t.html#a0d9112a997f95c8f792a48ee9b27d188">length</a>; i++) {</div><div class="line">        result = &amp;scanResultList.<a class="code" href="structaceWifiMgr__scanResultList__t.html#ad1da425df8e13db4afaef7cc5b6eef41">list</a>[i];</div><div class="line">        strncpy(ssid, result-&gt;<a class="code" href="structaceWifiMgr__scanResult__t.html#acb85f1bb7aff31678095daa5694733b1">ssid</a>, result-&gt;<a class="code" href="structaceWifiMgr__scanResult__t.html#aa207a91e91f5a17b14febf558715ab5b">ssidLength</a>);</div><div class="line">        ssid[result-&gt;<a class="code" href="structaceWifiMgr__scanResult__t.html#aa207a91e91f5a17b14febf558715ab5b">ssidLength</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">        printf(<span class="stringliteral">&quot;%3d  %32s  %3d\n&quot;</span>, i, ssid, result-&gt;<a class="code" href="structaceWifiMgr__scanResult__t.html#a2059cfdc689c3286e2d3966f42b0dc3c">rssi</a>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__ACE__WIFI__API.html#ga9b005db8002c62955fcd78daede0518b">aceWifiMgr_init</a>() != <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a2654bea679a5df6320eb993c7377cd60">aceWifiMgr_ERROR_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to init ACS WiFi.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__ACE__WIFI__API.html#ga72be17b63d832bf936a450c78826ff53">aceWifiMgr_registerScanDoneEvent</a>(scanEventCallback, NULL)</div><div class="line">        != <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a2654bea679a5df6320eb993c7377cd60">aceWifiMgr_ERROR_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to register for scan done events.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__ACE__WIFI__API.html#gad7978572fed308537be2113005ce682b">aceWifiMgr_startScan</a>();</div><div class="line"></div><div class="line">    <span class="comment">// wait for events</span></div><div class="line">    <span class="keywordflow">while</span>(1) {</div><div class="line">        sleep(5);</div><div class="line">        printScanResults();</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__ACE__WIFI__API.html#gadaf791e84f002944a40a19c1f753f74c">aceWifiMgr_deregisterScanDoneEvent</a>(scanEventCallback);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__ACE__WIFI__API.html#ga8841e12bd1d3befc483eb871d246a533">aceWifiMgr_deinit</a>() != <a class="code" href="group__ACE__WIFI__DEF.html#ggaa887845ddf49e5b5ea9861d5c4b699e6a2654bea679a5df6320eb993c7377cd60">aceWifiMgr_ERROR_SUCCESS</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Failed to deinit ACS WiFi.&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Other examples of API calls can be referenced in the CLI test files <em>wifi_cli.c</em> and <em>wifi_monitor.c</em>.</p>
<h1><a class="anchor" id="wifi_section_5"></a>
Build Artifacts</h1>
<p>Shared library name: <em>libace_wifimgr</em><br />
 WiFi service: <em>wifisvc</em><br />
</p>
<p>Optional modules used for testing: WiFi CLI: <em>wifi</em><br />
 WiFi monitor: <em>wifi_monitor</em><br />
</p>
<h1><a class="anchor" id="wifi_section_6"></a>
References</h1>
<ul>
<li><a class="el" href="group__ACE__WIFI.html">ACS Wifi Manager Middleware</a> </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
