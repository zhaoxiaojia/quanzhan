<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACS: FFS Provisionable User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACS
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__FFS__BLE__PROVISIONABLE__USER__GUIDE.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">FFS Provisionable User Guide<div class="ingroups"><a class="el" href="group__ACS__CORE__DOCS.html">ACS Core Docs</a> &raquo; <a class="el" href="group__USER__GUIDE.html">Middleware User Guides</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for FFS Provisionable User Guide:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__FFS__BLE__PROVISIONABLE__USER__GUIDE.png" border="0" alt="" usemap="#group____FFS____BLE____PROVISIONABLE____USER____GUIDE"/>
<map name="group____FFS____BLE____PROVISIONABLE____USER____GUIDE" id="group____FFS____BLE____PROVISIONABLE____USER____GUIDE">
<area shape="rect" id="node2" href="group__USER__GUIDE.html" title="Middleware User Guides" alt="" coords="5,13,171,39"/>
</map>
</td></tr></table></center>
</div>
<p><b>Version Number:</b> 0.5</p>
<ul>
<li><a class="el" href="group__FFS__BLE__PROVISIONABLE__USER__GUIDE.html#ffs_provisionable_ug_section_1">Introduction</a></li>
<li><a class="el" href="group__FFS__BLE__PROVISIONABLE__USER__GUIDE.html#ffs_provisionable_ug_section_2">Prerequisites</a></li>
<li><a class="el" href="group__FFS__BLE__PROVISIONABLE__USER__GUIDE.html#ffs_provisionable_ug_section_3">Usage/Best Practices</a></li>
<li><a class="el" href="group__FFS__BLE__PROVISIONABLE__USER__GUIDE.html#ffs_provisionable_ug_section_4">Build Artifacts</a></li>
<li><a class="el" href="group__FFS__BLE__PROVISIONABLE__USER__GUIDE.html#ffs_provisionable_ug_section_5">FAQ</a></li>
<li><a class="el" href="group__FFS__BLE__PROVISIONABLE__USER__GUIDE.html#ffs_provisionable_ug_section_6">References</a></li>
</ul>
<h1><a class="anchor" id="ffs_provisionable_ug_section_1"></a>
Introduction</h1>
<p><a href="https://developer.amazon.com/docs/frustration-free-setup/understanding-ffs.html">Frustration Free Setup (FFS)</a> is part of the <a href="https://www.amazon.com/b?node=19982322011&amp;ref_=ods_surl_cfh&amp;tag=theverge02-20">"Certified for Humans"</a> initiative that Amazon is driving for setting up consumer devices. The idea is to minimize the number of steps required in setting up a newly purchased device. For FFS to function, you would need a provisioner (an already setup device that you have at home such as an Echo or a phone/tablet running Alexa app) to provision the provisionee/provisionable (This document will use these two terms interchangeably. It means a new device that needs to be set up). The ACS FFS support for this module is the provisionee support (device side). <br />
</p>
<p>FFS can be conducted in the following ways:</p><ul>
<li><b>User Guided Setup (UGS).</b> This is when one uses the Alexa app on the phone/tablet to set up the device.</li>
<li><a href="https://developer.amazon.com/docs/frustration-free-setup/understanding-ffs.html#barcode-setup"><b>Barcode Setup.</b></a> This is when one uses the Alexa app on the phone to scan a factory generated 2D barcode on the device itself to initiate the device setup process.</li>
<li><a href="https://developer.amazon.com/docs/frustration-free-setup/understanding-ffs.html#zero-touch-setup"><b>Zero Touch Setup.</b></a> This is the most convenient way of setting a device in which one simply plugs in the device into the outlet and the provisioner will pick up the device automatically and finish the setup process. <br />
</li>
</ul>
<p>FFS provisionee also supports different types of transport (Bluetooth Low-energy (BLE) or Wifi). In this document, we are primarily focus on the FFS provisionee BLE based functionality. By utilizing the ACS FFS BLE provisionee support, device maker will be able to build the same device setup experience as first party Amazon products.</p>
<h1><a class="anchor" id="ffs_provisionable_ug_section_2"></a>
Prerequisites</h1>
<ul>
<li>On-boarding process:<ul>
<li>In order for FFS to be functional on a device, the device type itself has to be on-boarded with Device Setup Service back end.</li>
<li>Detailed instructions can be found <a href="https://developer.amazon.com/frustration-free-setup">here</a></li>
<li>Provisionee manufacturing related information can be found <a href="https://developer.amazon.com/docs/frustration-free-setup/provisionee-manufacturing.html">here</a></li>
</ul>
</li>
<li>Required ACS Middlewares:<ul>
<li><a class="el" href="group__ACEBT.html">ACE Bluetooth Middleware</a><ul>
<li><a class="el" href="group__ACE__BLE__API__BEACON.html">BLE Beacon Manager APIs</a> BLE beaconing support with custom beacon data</li>
<li><a class="el" href="group__ACE__BLE__API__GATT__SERVER.html">GATT Server APIs</a> BLE GATT server creation/tear-down, GATT characteristic read/write/send-notification/prepare-execute-write support</li>
</ul>
</li>
<li><a class="el" href="group__ACE__WIFI.html">ACS Wifi Manager Middleware</a><ul>
<li>Wifi scan, get scan result, connect and disconnect</li>
</ul>
</li>
<li>ACM<ul>
<li>This is HTTP client used for DSS metrics upload.</li>
</ul>
</li>
<li>ACE_METRIC<ul>
<li>This is for logging FFS metrics. (Optional)</li>
</ul>
</li>
<li>ACE_LOG<ul>
<li>This is for logging purposes.</li>
</ul>
</li>
</ul>
</li>
<li>Required DPK HALs:<ul>
<li><a class="el" href="group__ACS__HAL__DHAV2.html">Device Hardware Authentication (DHA)</a><ul>
<li>This is for device authenticity validation purposes.</li>
<li>This user guide assumes the device certificate is programmed correctly.</li>
</ul>
</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO.html">Device Info</a> fields required for FFS. Please ensure these fields are programmed accordingly.<ul>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23cab688adfab6d611ae877ccb76b8f86d7a">DEVICE_SERIAL</a>, device serial number</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23caa3125ab0f8d8d405622156634a2fab31">DEVICE_TYPE_ID</a>, device type</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23ca6c2d445571c53a6ffaa9ad9e84258e6b">PRODUCT_ID</a>, FFS product ID (product specific). Obtained after the device onboard process.</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23ca36f3e020175ebe388b8bbaad60888923">MANUFACTURING</a>, manufacturer name</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23ca281f6545163ddb0a242b3085eacf9841">OS_VERSION</a>, software version</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23ca359e12973b409357943bf31045045735">DEV_HW_REV</a>, hardware revision number</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23ca0631fd686940471df9ee1f8861496855">FFS_PIN</a>, FFS pin code for 2D barcode operation. Not required if FFS 2D barcode is not supported for your product.</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23ca0d0d2eb6d33018fca3ee48ccdcf15c25">DSS_PUB_KEY</a>, FFS device setup service public key (product specific). Obtained after the device onboard process.</li>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23ca25897fbdfa9a2fcb9ad4c4f2a1a3c984">BT_DEVICE_NAME</a>, Bluetooth device name displayed when beaconing. Product name is usually used here and the device name will appear as (BT_DEVICE_NAME-xyz, where xyz is the last 3 characters of the DSN).</li>
<li>3P AVS specific field(s)<ul>
<li><a class="el" href="group__ACE__HAL__DEVICE__INFO__DS.html#ggadc4e15d089ee7b1e9d22c1741fe5f23cadbccc274318f909228d315dd749f71fc">CLIENT_ID</a>, Alexa 3P device maker's client-id</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Required OSS libraries:<ul>
<li>Mbedtls<ul>
<li>This is used for FFS session key generation and payload validation</li>
<li>MBEDTLS_ECDH_C, MBEDTLS_ECDSA_C, MBEDTLS_ECJPAKE_C and all its dependencies</li>
</ul>
</li>
<li>Libwebsocket<ul>
<li>This is used by ACM internally</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="ffs_provisionable_ug_section_3"></a>
Usage/Best Practices</h1>
<ul>
<li>Default beaconing timeout is set to <a class="el" href="group__FFS__DATA.html#ga77623ef1e1318c9d3b0994495ce4b8fd">ACE_FFS_DEFAULT_ADVERTISING_TIMEOUT</a> seconds. It is not recommended to set to something less than 1 minutes because it can prevent provisioner from picking it up if there are multiple devices need to be provisioned in the vicinity.</li>
<li>The ACS FFS APIs are designed to be integrated to an existing device setup service daemon/service.</li>
<li>Architectural diagram: <div class="image">
<img src="ffs_arch_diagram.png" alt="ffs_arch_diagram.png"/>
</div>
</li>
<li>API call example: ACS FFS APIs are asynchronous in nature.</li>
</ul>
<div class="image">
<img src="ffs_api_sequence.png" alt="ffs_api_sequence.png"/>
</div>
<ul>
<li>Here is a reference FFS test daemon. FFS test daemon can be enable through the <b>ACE_FFS_PROVISIONABLE_TEST_DAEMON</b> configuration option. It can used for first level testing without integrating into your own device set up service.<ul>
<li>FFS Test Daemon usage <div class="fragment"><div class="line">ffsd_test -h</div><div class="line"></div><div class="line">Hello I am FFS Provisionable Test Daemon</div><div class="line">ffsd_test: invalid option -- h</div><div class="line">unknown option: 63</div><div class="line">  -m mode (1 = ZTS, 2 = 2D, 4 = UGS, add them to combine modes)</div><div class="line">  -t Watchdog time in seconds</div><div class="line">  -a Advertisement timeout in seconds</div><div class="line">  -b Provisioner timeout in seconds</div><div class="line"></div><div class="line"><span class="preprocessor"># To start in UGS mode</span></div><div class="line">ffsd_test -m 4</div><div class="line"></div><div class="line"><span class="preprocessor"># To start in UGS + 2D mode</span></div><div class="line">ffsd_test -m 6</div><div class="line"></div><div class="line"><span class="preprocessor"># One can then proceed to use the FFS test provisioner app. on the phone to connect to the device</span></div></div><!-- fragment --></li>
<li>Code reference <div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Copyright 2018-2019 Amazon.com, Inc. or its affiliates. All rights reserved.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * AMAZON PROPRIETARY/CONFIDENTIAL</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You may not use this file except in compliance with the terms and</span></div><div class="line"><span class="comment"> * conditions set forth in the accompanying LICENSE.TXT file.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * THESE MATERIALS ARE PROVIDED ON AN &quot;AS IS&quot; BASIS. AMAZON SPECIFICALLY</span></div><div class="line"><span class="comment"> * DISCLAIMS, WITH RESPECT TO THESE MATERIALS, ALL WARRANTIES, EXPRESS,</span></div><div class="line"><span class="comment"> * IMPLIED, OR STATUTORY, INCLUDING THE IMPLIED WARRANTIES OF MERCHANTABILITY,</span></div><div class="line"><span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;ace/ace.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ace/ffs_provisionable_api.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ace/osal_time.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SEC_TO_MS(x) (x * 1000)</span></div><div class="line"><span class="keyword">static</span> aceTimer_t monitor_timer;</div><div class="line"><span class="keyword">static</span> uint32_t ffs_watchdog_timeout = SEC_TO_MS(120); <span class="comment">/* 2 minutes in ms */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> should_die = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> pthread_cond_t cv = PTHREAD_COND_INITIALIZER;</div><div class="line"><span class="keyword">static</span> pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> bye(<span class="keywordtype">void</span>) {</div><div class="line">    should_die = <span class="keyword">true</span>;</div><div class="line">    pthread_cond_signal(&amp;cv);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sig_handler(<span class="keywordtype">int</span> signo) {</div><div class="line">    <span class="keywordflow">if</span> (signo == SIGINT) {</div><div class="line">        bye();</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> reg_complete_cb(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">int</span> r) {</div><div class="line">    (void)ctx;</div><div class="line">    printf(<span class="stringliteral">&quot;Registration finished with rc(%d)\n&quot;</span>, r);</div><div class="line">    <span class="keywordflow">if</span> (r == 0) {</div><div class="line">        <span class="comment">/* registration complete, do the UI stuff (if any) */</span></div><div class="line">        bye();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ffs_watchdog(<span class="keywordtype">void</span>* ctx) {</div><div class="line">    (void)ctx;</div><div class="line">    printf(<span class="stringliteral">&quot;FFS Watchdog\n&quot;</span>);</div><div class="line">    bye();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ffs_stopped_cb(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">int</span> reason) {</div><div class="line">    (void)ctx;</div><div class="line">    printf(<span class="stringliteral">&quot;FFS Stopped with reason=%d\n&quot;</span>, reason);</div><div class="line">    bye();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> wifi_connect_state_cb(<span class="keywordtype">void</span>* ctx, <a class="code" href="group__FFS__DATA.html#ga8e094e92a98314fa0cc508e65fd674a8">aceFfs_wifiState_t</a> state,</div><div class="line">                                 <a class="code" href="group__FFS__DATA.html#gae2ed4e7e884894e07044ba367a91b90d">aceFfs_wifiReason_t</a> reason) {</div><div class="line">    (void)ctx;</div><div class="line">    printf(<span class="stringliteral">&quot;Wifi state(%d) reason(%d)\n&quot;</span>, state, reason);</div><div class="line">    <span class="keywordflow">if</span> (state == <a class="code" href="group__FFS__DATA.html#gga8e094e92a98314fa0cc508e65fd674a8a1f2cc66b78275b3206877ec37a365e48">ACE_FFS_WIFI_DISCONNECTED</a> &amp;&amp;</div><div class="line">        reason == <a class="code" href="group__FFS__DATA.html#ggae2ed4e7e884894e07044ba367a91b90dad52ea44680a2038f2df61e371babc4a7">ACE_FFS_WIFI_BEHIND_CAPTIVE_PORTAL</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;Behind captive portal, bail..\n&quot;</span>);</div><div class="line">        bye();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ffs_timeout_cb(<span class="keywordtype">void</span>* ctx) {</div><div class="line">    <a class="code" href="group__FFS__DATA.html#ga6a8d56716f9aa93874b8ba36334aa8e3">aceFfs_provisioningState_t</a> state = 0;</div><div class="line">    (void)ctx;</div><div class="line">    printf(<span class="stringliteral">&quot;FFS Watchdog fired\n&quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__FFS__API.html#gafc647d3455d65c7c127d28319a314fad">aceFfs_getState</a>(&amp;state) != <a class="code" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082a7e00e1cea5651ed109b79fd13a9baeb4">ACE_STATUS_OK</a> ||</div><div class="line">        state &lt; <a class="code" href="group__FFS__DATA.html#gga6a8d56716f9aa93874b8ba36334aa8e3a48098e73cd1a3c388f80cc456a465cf6">ACE_FFS_PROV_ACTIVELY_PROVISIONING</a>) {</div><div class="line">        <span class="comment">/* not making enough progress, die.. */</span></div><div class="line">        printf(<span class="stringliteral">&quot;Not making progress..bye\n&quot;</span>);</div><div class="line">        bye();</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <span class="comment">/* we seem to be making progress, start another one-shot timer */</span></div><div class="line">        aceTime_timerStart(&amp;monitor_timer, ffs_watchdog_timeout);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> help() {</div><div class="line">    printf(<span class="stringliteral">&quot;  -m mode (1 = ZTS, 2 = 2D, 4 = UGS, add them to combine modes)\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;  -t Watchdog time in seconds\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;  -a Advertisement timeout in seconds\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;  -b Provisioner timeout in seconds\n&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** args) {</div><div class="line">    <span class="keywordtype">int</span> option = 0;</div><div class="line">    <span class="keywordtype">bool</span> verbose = <span class="keyword">false</span>;</div><div class="line">    <a class="code" href="structaceFfs__config__t.html">aceFfs_config_t</a> init_param = {0};</div><div class="line">    uint16_t mode = <a class="code" href="group__FFS__DATA.html#gga4356da768fd338f448aa5e9d50e81cd8a9f74ff0ab2f7b79276776684e80c75db">ACE_FFS_MODE_UGS</a>;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Hello I am FFS Provisionable Test Daemon\n&quot;</span>);</div><div class="line">    <span class="keywordflow">while</span> ((option = getopt(argc, args, <span class="stringliteral">&quot;a:b:t:m:s&quot;</span>)) != -1) {</div><div class="line">        <span class="keywordflow">switch</span> (option) {</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div><div class="line">                init_param.<a class="code" href="structaceFfs__config__t.html#a27268f2f7130189dad73addde76e0a02">advertising_timeout</a> = atoi(optarg);</div><div class="line">                printf(<span class="stringliteral">&quot;FFS beacon timeout set to %d seconds\n&quot;</span>,</div><div class="line">                       init_param.<a class="code" href="structaceFfs__config__t.html#a27268f2f7130189dad73addde76e0a02">advertising_timeout</a>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div><div class="line">                init_param.<a class="code" href="structaceFfs__config__t.html#a3f01a9442dcab014476b06a97195ba2e">provisioner_timeout</a> = atoi(optarg);</div><div class="line">                printf(<span class="stringliteral">&quot;FFS provisioner timeout set to %d seconds\n&quot;</span>,</div><div class="line">                       init_param.<a class="code" href="structaceFfs__config__t.html#a3f01a9442dcab014476b06a97195ba2e">provisioner_timeout</a>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div><div class="line">                <span class="keywordflow">if</span> (atoi(optarg) &gt; 0) {</div><div class="line">                    ffs_watchdog_timeout = atoi(optarg);</div><div class="line">                    printf(<span class="stringliteral">&quot;FFS watchdog set to %d seconds\n&quot;</span>,</div><div class="line">                           ffs_watchdog_timeout);</div><div class="line">                    ffs_watchdog_timeout = SEC_TO_MS(ffs_watchdog_timeout);</div><div class="line">                    <a class="code" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> r = aceTime_timerNew(&amp;monitor_timer, ACETIME_CLOCK_MONOTONIC,</div><div class="line">                                                      ACETIME_TIMER_ONESHOT,</div><div class="line">                                                      ffs_timeout_cb, NULL);</div><div class="line">                    <span class="keywordflow">if</span> (r != <a class="code" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082a7e00e1cea5651ed109b79fd13a9baeb4">ACE_STATUS_OK</a>) {</div><div class="line">                        printf(<span class="stringliteral">&quot;Failed to start watchdog timer\n&quot;</span>);</div><div class="line">                        exit(1);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div><div class="line">                mode = atoi(optarg);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                printf(<span class="stringliteral">&quot;unknown option: %d\n&quot;</span>, option);</div><div class="line">                help();</div><div class="line">                <span class="keywordflow">return</span> 1;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    init_param.<a class="code" href="structaceFfs__config__t.html#a02369a8fc381ef8d4a87682495966f01">registration_complete</a> = reg_complete_cb;</div><div class="line">    init_param.<a class="code" href="structaceFfs__config__t.html#a1e9ad18cc4d7ba9906a12d5cedbdf804">stopped</a> = ffs_stopped_cb;</div><div class="line">    init_param.<a class="code" href="structaceFfs__config__t.html#ac8925e50a0127c175988214dbb97497b">wifi_connect_state</a> = wifi_connect_state_cb;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Provision mode = 0x%x\n&quot;</span>, mode);</div><div class="line">    signal(SIGINT, sig_handler);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__FFS__API.html#ga17deb508949871d8866b3ba2ad06c4c7">aceFfs_init</a>(&amp;init_param) != <a class="code" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082a7e00e1cea5651ed109b79fd13a9baeb4">ACE_STATUS_OK</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;aceFfs_init failed\n&quot;</span>);</div><div class="line">        bye();</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__FFS__API.html#ga430b3d2cacd015f0e836acbe34f8dc78">aceFfs_start</a>(mode) != <a class="code" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082a7e00e1cea5651ed109b79fd13a9baeb4">ACE_STATUS_OK</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;aceFfs_start failed\n&quot;</span>);</div><div class="line">        bye();</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* start the timer */</span></div><div class="line">    <span class="keywordflow">if</span> (ffs_watchdog_timeout)</div><div class="line">        aceTime_timerStart(&amp;monitor_timer, ffs_watchdog_timeout);</div><div class="line"></div><div class="line">    <span class="comment">/* start the UI stuff (if any) */</span></div><div class="line"></div><div class="line">    <span class="comment">/* waiting... */</span></div><div class="line">    pthread_mutex_lock(&amp;lock);</div><div class="line">    <span class="keywordflow">while</span> (!should_die)</div><div class="line">        pthread_cond_wait(&amp;cv, &amp;lock);</div><div class="line">    pthread_mutex_unlock(&amp;lock);</div><div class="line"></div><div class="line">    aceTime_timerDelete(&amp;monitor_timer);</div><div class="line"></div><div class="line">    <a class="code" href="group__FFS__API.html#gab6fd8c09cfc4d002939a4df4a5f168ac">aceFfs_stop</a>();</div><div class="line">    printf(<span class="stringliteral">&quot;FFS Test Daemon Stopped\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="ffs_provisionable_ug_section_4"></a>
Build Artifacts</h1>
<p>Shared library name: libace_ffs<br />
</p>
<p>Code size breakdowns (in bytes): These are approximate numbers gathered from an RTOS build. The actual code size, etc depends on compiler and compilation options.</p>
<table class="doxtable">
<tr>
<th align="right">Module </th><th align="center">.text </th><th align="left">.data </th><th align="left">.bss  </th></tr>
<tr>
<td align="right">libace_ffs </td><td align="center">64063 </td><td align="left">411 </td><td align="left">1041 </td></tr>
</table>
<p>Run-time memory requirement: This is more relevant for RTOS devices. The recommendation would be at least 90 Kbytes of free memory when enabling FFS service.</p>
<h1><a class="anchor" id="ffs_provisionable_ug_section_5"></a>
FAQ</h1>
<ul>
<li>How do we test FFS provisionable feature once integrated on my device?<ul>
<li>FFS Test App would be the preferable choice which is available on IOS/Android. Please contact ACS support on where to download the application.</li>
</ul>
</li>
<li>What sort of certification do we need once a device is on-board with FFS?<ul>
<li>Certification process can be found <a href="https://developer.amazon.com/docs/frustration-free-setup/wi-fi-provisionee-certification.html">here</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="ffs_provisionable_ug_section_6"></a>
References</h1>
<ul>
<li><a class="el" href="group__FFS.html">API documentation</a>.</li>
<li>2D barcode <a href="https://developer.amazon.com/docs/frustration-free-setup/provisionee-manufacturing-barcode-specification.html">specification</a>. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
