<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACS: DHAv2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACS
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__DHAV2__PORTING__GUIDE.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DHAv2<div class="ingroups"><a class="el" href="group__ACS__CORE__DOCS.html">ACS Core Docs</a> &raquo; <a class="el" href="group__PORTING__GUIDE.html">DPK Porting Guides</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for DHAv2:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__DHAV2__PORTING__GUIDE.png" border="0" alt="" usemap="#group____DHAV2____PORTING____GUIDE"/>
<map name="group____DHAV2____PORTING____GUIDE" id="group____DHAV2____PORTING____GUIDE">
<area shape="rect" id="node2" href="group__PORTING__GUIDE.html" title="DPK Porting Guides" alt="" coords="5,5,145,32"/>
</map>
</td></tr></table></center>
</div>
<ul>
<li><a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_1">Background</a></li>
<li><a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_2">Target Audience</a></li>
<li><a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_3">Definitions</a></li>
<li><a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_4">Implementation Guidance</a><ul>
<li><a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_5">Protection of DHAv2 Private Key at rest</a></li>
<li><a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_6">Validation</a></li>
<li><a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_7">Testing</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="dhav2_port_1"></a>
Background</h1>
<p>DHAv2 HAL is a set of APIs that operate on two persistently stored data on a device:</p>
<ul>
<li>DHAv2 Private Key</li>
<li>DHAv2 Certificate Chain</li>
</ul>
<p>These two data serve as the root identity of an ACS device. Generation of this identity happens at manufacturing, and there are 2 major use cases where this identity is used:</p>
<ol type="1">
<li>Frustration Free Setup (FFS) provisionable</li>
<li>AWS IoT Registration (in future)</li>
</ol>
<h1><a class="anchor" id="dhav2_port_2"></a>
Target Audience</h1>
<p>You can skip this Porting Guide if your hardware and software platform only needs to support <a href="https://login.amazon.com/">Login With Amazon</a> (LWA).</p>
<p>For Device Porting Kit (DPK) implementers wanting to port ACS on their own hardware and software platform supporting FFS provisionable registration based upon DHAv2, please continue to read.</p>
<h1><a class="anchor" id="dhav2_port_3"></a>
Definitions</h1>
<ol type="1">
<li>DHAv2 Private Key</li>
</ol>
<p>A NIST P-256 Elliptic Curve (EC) key pair that is stored persistently on device and protected at rest (see <a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_4">Implementation Guidance</a>). This key is generated at runtime when <a class="el" href="group__ACS__HAL__DHAV2.html#ga16b6005919d8a441bdd684edb6ef8851">aceDhaHal_generateKey</a> is called.</p>
<ol type="1">
<li>DHAv2 Certificate Chain</li>
</ol>
<p>A X.509 Certificate Chain that is stored persistently on device. The first certificate (leaf certificate) provides identity information about the device, and the certificate chain traces up to a DHAv2 Root Certificate Authority (CA). Paired with the DHAv2 Private Key this forms a root identity for the device.</p>
<h1><a class="anchor" id="dhav2_port_3"></a>
Definitions</h1>
<p>Given these requirements, a DPK implementer must implement this set of DHAv2 APIs:</p>
<ul>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga16b6005919d8a441bdd684edb6ef8851">aceDhaHal_generateKey</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga465da4898f2ce16701cd7d507bc08954">aceDhaHal_getPublicKey</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga2b1b7782c76fc5aaed89729ed30cea0b">aceDhaHal_signData</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga4710be0a78caa2deb1bced4a4b5ef0de">aceDhaHal_verifyData</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga7ddc1484977507cb7873fc7a2b75872d">aceDhaHal_getField</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga7e9d46fc871f552e551e3fb955723a65">aceDhaHal_setCertificate</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga89caae9d8f8f8bbbea71d6e4f49c5934">aceDhaHal_open</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#gaa6c1a0cb316e414d1a02d76907cb8dec">aceDhaHal_close</a></li>
</ul>
<p>Shared library name: libacehal_dha</p>
<h1><a class="anchor" id="dhav2_port_4"></a>
Implementation Guidance</h1>
<p>For detailed information on individual APIs, please refer to the <a class="el" href="group__ACS__HAL__DHAV2.html">API documentation</a>.</p>
<h2><a class="anchor" id="dhav2_port_5"></a>
Protection of DHAv2 Private Key at rest</h2>
<p>DHAv2 Private Key is critical to the root identity of an ACS device. If this is compromised or leaked, device cloning can occur and an attacker can exploit the DHAv2 Private Key and claim itself as a valid ACS device.</p>
<p>A DPK implementor MUST use the strongest mechanism on the hardware platform to protect the DHAv2 Private Key at rest. Below is a list of recommendations (from the best to least preferred):</p>
<ul>
<li>Protected by a hardware cryptographic engine.</li>
<li>Protected by a Trusted Execution Environment (TEE) (e.g. ARM TrustZone or TrustZone-M).</li>
<li>Encrypted in flash using a symmetric key stored in One Time Programmable (OTP) fuses or Physically Unclonable Functions (PUFs).</li>
</ul>
<p>Storing the DHAv2 Private Key in plain-text is <b>HIGHLY DISCOURAGED</b>. Contact ACS support if your platform can only store the DHAv2 Private Key in plain-text.</p>
<h2><a class="anchor" id="dhav2_port_6"></a>
Validation</h2>
<p>A DHAv2 HAL Test Suite exists to ensure the behaviors are correct according to the API definition.</p>
<p>The ACS team also reserves the right to review the implementation to ensure the DHAv2 Private Key is properly protected according to the <a class="el" href="group__DHAV2__PORTING__GUIDE.html#dhav2_port_4">Implementation Guidance</a>.</p>
<h3><a class="anchor" id="CSR"></a>
Production and Validation</h3>
<ol type="1">
<li>Implement all the required functions, except <a class="el" href="group__ACS__HAL__DHAV2.html#ga7e9d46fc871f552e551e3fb955723a65">aceDhaHal_setCertificate</a>.</li>
<li>Produce a device CSR after calling the following functions:<ul>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga89caae9d8f8f8bbbea71d6e4f49c5934">aceDhaHal_open</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga16b6005919d8a441bdd684edb6ef8851">aceDhaHal_generateKey</a></li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#ga7ddc1484977507cb7873fc7a2b75872d">aceDhaHal_getField</a> (ACE_DHA_CSR, ...)</li>
<li><a class="el" href="group__ACS__HAL__DHAV2.html#gaa6c1a0cb316e414d1a02d76907cb8dec">aceDhaHal_close</a></li>
</ul>
</li>
<li>Submit the CSR to us for validation.</li>
</ol>
<p>We will then provide you with a certificate chain that corresponds to the provided CSR.</p>
<h3><a class="anchor" id="Certificate"></a>
Chain Setting</h3>
<ol type="1">
<li>Using the certificate chain, implement <a class="el" href="group__ACS__HAL__DHAV2.html#ga7e9d46fc871f552e551e3fb955723a65">aceDhaHal_setCertificate</a>.</li>
</ol>
<h2><a class="anchor" id="dhav2_port_7"></a>
Testing</h2>
<ul>
<li>A DHAv2 HAL Test Suite exists to ensure the behaviors are correct according to the API definition. This is part of the DPK Test Suite (DTS), which is covered in a separate package.</li>
<li>The ACS team also reserves the right to review the implementation to ensure the DHAv2 Private Key is properly protected according to the implementation guidance. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
