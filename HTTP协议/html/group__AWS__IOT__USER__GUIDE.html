<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACS: AWS_IOT User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACS
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__AWS__IOT__USER__GUIDE.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AWS_IOT User Guide<div class="ingroups"><a class="el" href="group__ACS__CORE__DOCS.html">ACS Core Docs</a> &raquo; <a class="el" href="group__USER__GUIDE.html">Middleware User Guides</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for AWS_IOT User Guide:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__AWS__IOT__USER__GUIDE.png" border="0" alt="" usemap="#group____AWS____IOT____USER____GUIDE"/>
<map name="group____AWS____IOT____USER____GUIDE" id="group____AWS____IOT____USER____GUIDE">
<area shape="rect" id="node2" href="group__USER__GUIDE.html" title="Middleware User Guides" alt="" coords="5,5,171,32"/>
</map>
</td></tr></table></center>
</div>
<p><b>Version Number:</b> 1.1</p>
<ul>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_1">Introduction</a></li>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_2">Dependencies</a></li>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_3">Rules and limits</a></li>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_4">Usage/Best Practices</a></li>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_5">Build Artifacts</a></li>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_6">Debugging into Logs</a></li>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_7">FAQ</a></li>
<li><a class="el" href="group__AWS__IOT__USER__GUIDE.html#aws_iot_sdk_section_8">References</a></li>
</ul>
<h1><a class="anchor" id="aws_iot_sdk_section_1"></a>
Introduction</h1>
<p>The AWS IoT SDK for embedded C is a collection of C99 source files that allow applications to securely connect to the AWS IoT platform. It includes an MQTT 3.1.1 client, as well as libraries specific to AWS IoT, such as Thing Shadows. It is distributed in source form and may be built into firmware along with application code. AWS IoT SDK has been ported to ACS and may be used by all platforms that ACS supports. The ACS distribution of AWS IoT SDK also includes an additional feature to share a single MQTT connection between users on a system. For further information please refer - <a href="https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/main/index.html">https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/main/index.html</a></p>
<h1><a class="anchor" id="aws_iot_sdk_section_2"></a>
Dependencies</h1>
<p>AWS IoT SDK depends on the following:</p><ol type="1">
<li><b> OSAL_CORE </b> - For timers, threads and locks specific to the reference platform used (RTOS/POSIX)</li>
<li><b> ACE_UTILS </b> - Convert unsigned 64-bit integer to printable C string</li>
<li><b> TINYCBOR </b> - CBOR encoder and decoder library, optimized for very fast operation with very small footprint</li>
<li><b> MBEDTLS </b> - For secured connection with the backend server</li>
</ol>
<h1><a class="anchor" id="aws_iot_sdk_section_3"></a>
Rules and limits</h1>
<dl class="section note"><dt>Note</dt><dd>The current ACS porting layer has a required dependency on mbedtls (version &gt; 2.4.2).</dd></dl>
<h1><a class="anchor" id="aws_iot_sdk_section_4"></a>
Usage/Best Practices</h1>
<ol type="1">
<li>Include library into your ace.mk or Android.mk and module.conf<ul>
<li><pre class="fragment">SHARED_LIBRARIES: libaws_iot_sdk </pre></li>
</ul>
</li>
<li>Include below iot_socket header file in your source files for accessing functionality of initialization, opening, closing, shutting down a connection.<ul>
<li><pre class="fragment">#include "iot_socket.h" </pre></li>
</ul>
</li>
<li>Use Socket APIs to initialize, open, close and shutdown mqtt connections<ul>
<li><pre class="fragment">IotSocket_Init() </pre></li>
<li><pre class="fragment">IotSocket_Open() </pre></li>
<li><pre class="fragment">IotSocket_Close() </pre></li>
<li><pre class="fragment">IotSocket_Shutdown() </pre></li>
</ul>
</li>
<li>For other functionalities like publish/subscribe to a topic or send/receive messages, etc. Please refer - <a href="https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/mqtt/mqtt_functions.html">https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/mqtt/mqtt_functions.html</a> for available APIs.</li>
</ol>
<p><b> Features </b><br />
 Please refer - <a href="https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/v4_beta#features">https://github.com/aws/aws-iot-device-sdk-embedded-C/tree/v4_beta#features</a> to understand the features provided by the library. Additionally, this distribution contains additional APIs to share a common TLS connection for multiple users.</p>
<p>Follow the below steps to use AWS_IOT SDK</p>
<p><b> Initial Server Setup </b><br />
</p><ol type="1">
<li>In order to setup AWS_IOT backend server please follow the instructions given on the below link. Link - <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-gs.html">https://docs.aws.amazon.com/iot/latest/developerguide/iot-gs.html</a></li>
</ol>
<p>Once the Server is setup and the ACS distribution source package for the library is downloaded it is ready to use.</p>
<p><b> Socket API Documentation </b><br />
 The AWS_IOT_SDK provides four APIs to initialize, open, close and shutdown a socket connection using a socket handle. These APIs can be used for sharing connections. In addition the AWS_IOT SDK also provides various other mqtt APIs as given in the below link. Link - <a href="https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/mqtt/mqtt_functions.html">https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/mqtt/mqtt_functions.html</a></p>
<p><b>1. Initialize a socket handle </b><br />
</p>
<p><b> API</b><br />
 IotSocketError_t IotSocket_Init( void )</p>
<p><b>Description</b><br />
 One-time initialization function for the IotSocket library This function performs setup for the Socket library. It must be called before calling any other IotSocket function. This function may be called multiple times, but is not safe to call this function with multiple threads simultaneously. This will initialize the AWS IoT SDK, the network layer, and the MQTT client. This may spawn threads and allocate memory to handle future SDK operations. To reclaim this memory, call IotSocket_Shutdown.</p>
<dl class="section return"><dt>Returns</dt><dd>One of the following:<ul>
<li>#IOT_SOCKET_SUCCESS</li>
<li>#IOT_SOCKET_NOT_INITIALIZED</li>
</ul>
</dd></dl>
<p><b> 2. Open a shared/non-shared socket handle </b><br />
</p>
<p><b> API</b><br />
 IotSocketError_t IotSocket_Open( IotSocketHandle_t* pSocketHandle, IotSocketOptions_t* pSocketOptions )</p>
<p><b>Description</b><br />
 Connection management function to return an active connection This function may block while initializing and maintaining a connection. It may also signal that the call to Open may be retried after some time if IOT_SOCKET_DISCONNECTED is returned. Custom connection parameters may be passed in through the pSocketOptions argument, or, if NULL is passed, the SocketHandle returned will use default options. The default option will create a shared connection if previously provisioned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pSocketHandle</td><td>pointer to Socket </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pSocketOptions</td><td>pointer to options</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>One of the following:<ul>
<li>#IOT_SOCKET_SUCCESS</li>
<li>#IOT_SOCKET_NOT_INITIALIZED</li>
<li>#IOT_SOCKET_INVALID_PARAM</li>
<li>#IOT_SOCKET_NOT_SUPPORTED</li>
<li>#IOT_SOCKET_DISCONNECTED</li>
</ul>
</dd></dl>
<p><b> 3. Close a shared/non-shared socket handle </b><br />
</p>
<p><b> API</b><br />
 IotSocketError_t IotSocket_Close( IotSocketHandle_t* pSocketHandle, IotSocketCloseFlags_t socketCloseFlag)</p>
<p><b>Description</b><br />
 Connection management function to release an active connection After returning from this function with IOT_SOCKET_SUCCESS, the passed in pSocketHandle will be reset to an uninitialized state and may be reused.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pSocketHandle</td><td>pointer to Socket to be closed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">socketCloseFlag</td><td>is used to indicate forceful socket disconnection</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>One of the following:<ul>
<li>#IOT_SOCKET_SUCCESS</li>
<li>#IOT_SOCKET_NOT_INITIALIZED</li>
<li>#IOT_SOCKET_INVALID_PARAM</li>
</ul>
</dd></dl>
<p><b> 4. Shutdown a shared/non-shared socket handle</b><br />
</p>
<p><b> API</b><br />
 IotSocketError_t IotSocket_Shutdown( void )</p>
<p><b>Description</b><br />
 Shuts down the IotSocket library, reclaiming allocations This function may not be called until after IotSocket_Init, and should not be called while there are open SocketHandles. Any open SocketHandles are closed and immediately become invalid. Existing operations on those sockets will complete, but any future calls using the connection may result in a crash. After a call to this function, future calls to Open will result in a return of IOT_SOCKET_NOT_INITIALIZED until IotSocket_Init is called.</p>
<dl class="section return"><dt>Returns</dt><dd>One of the following:<ul>
<li>#IOT_SOCKET_SUCCESS</li>
<li>#IOT_SOCKET_NOT_INITIALIZED</li>
</ul>
</dd></dl>
<p><b> API Arguments and Socket flags</b><br />
 <b> 1. Socket Handle (IotSocketHandle_t) </b><br />
 The "IotSocketHandle_t" is a structure that contains socket information like its mqtt connection, socket options, socket state and a mutex lock as given below.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>IotSocketHandle {</div><div class="line"></div><div class="line">   IotMqttConnection_t connection; <span class="comment">// Connection for using MQTT functions</span></div><div class="line"></div><div class="line">   IotSocketOptions_t  options;    <span class="comment">// Socket options and connection parameters</span></div><div class="line"></div><div class="line">   IotSocketState_t    state;      <span class="comment">// Current state of the socket</span></div><div class="line"></div><div class="line">   IotMutex_t          mutex;      <span class="comment">// Socket shared mutex</span></div><div class="line"></div><div class="line">} IotSocketHandle_t;</div></div><!-- fragment --><p><b> 2. Socket Options (IotSocketOptions_t) </b><br />
 The "IotSocketOptions_t" is a structure that contains various Socket options like Socketflags, timeout, keep alive time, reconnect timeout, Network and connection information as given below.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>IotSocketOptions {</div><div class="line"></div><div class="line">    IotSocketFlags_t          flags;        <span class="comment">// Flags to define this socket&#39;s behavior</span></div><div class="line"></div><div class="line">    uint32_t                  timeout_ms;   <span class="comment">// The time in milliseconds when this operation should timeout</span></div><div class="line"></div><div class="line">    uint32_t                  keepalive_s;  <span class="comment">// The time in seconds to periodically send keepalive packets</span></div><div class="line"></div><div class="line">    uint32_t                  reconnect_s;  <span class="comment">// The time in seconds to attempt a reconnect, should be longer than 0.5 * keepalive_s</span></div><div class="line"></div><div class="line">    IotMqttNetworkInfo_t *    pNetworkInfo; <span class="comment">// Optionally provisioned x509 credentials for connection parameters</span></div><div class="line"></div><div class="line">    IotMqttConnectInfo_t *    pConnectInfo; <span class="comment">// Optionally customized connection info for connection parameters</span></div><div class="line"></div><div class="line">} IotSocketOptions_t;</div></div><!-- fragment --><p><b> 3. Socket Flags </b><br />
 The "IotSocketFlags_t" is an enum that indicates the type of connection being created like creation of an shared vs unshared connection or whether separately provisioning the connection with connection parameters or using the default ones. The IotSocketFlags_t are treated as bit fields.</p>
<div class="fragment"><div class="line">  <span class="keyword">typedef</span> <span class="keyword">enum</span> IotSocketFlags {</div><div class="line"> </div><div class="line">     IOT_SOCKETOPT_NONE                = 0x0,  <span class="comment">// This flag indicates no special flags passed for IotSocket_Open</span></div><div class="line"> </div><div class="line">     IOT_SOCKETOPT_SHARED              = 0x1,  <span class="comment">// Use the shared socket if available, else create one.</span></div><div class="line"> </div><div class="line">     IOT_SOCKETOPT_PROVISION           = 0x2,  <span class="comment">// Use to provision connections with non-default options.</span></div><div class="line">                                               <span class="comment">// When set, the connection will be created using the</span></div><div class="line">                                               <span class="comment">// provided NetworkInfo and ConnectInfo passed into IotSocket_Open.</span></div><div class="line">                                               <span class="comment">// When set with IOT_SOCKETOPT_SHARED, the shared connection will</span></div><div class="line">                                               <span class="comment">// connect with the provided NetworkInfo and ConnectInfo options if</span></div><div class="line">                                               <span class="comment">// not already connected. To force the shared connection to use the newly</span></div><div class="line">                                               <span class="comment">// provisioned options, combine with IOT_SOCKETOPT_FORCE_CONNECT</span></div><div class="line"> </div><div class="line">      IOT_SOCKETOPT_MAX                 = 0x4  <span class="comment">// Maximum bit value of the enum</span></div><div class="line">} IotSocketFlags_t;</div></div><!-- fragment --><p><b> 4. Socket Close Flags </b><br />
 The "IotSocketCloseFlags_t" is an enum that indicates whether the shared socket will be disconnected after all the sockets are closed.</p>
<div class="fragment"><div class="line">  <span class="keyword">typedef</span> <span class="keyword">enum</span> IotSocketCloseFlags {</div><div class="line"> </div><div class="line">     IOT_SOCKETCLOSEOPT_NONE                 = 0x0,  <span class="comment">// This flag indicates no special flags passed for IotSocket_Close</span></div><div class="line"> </div><div class="line">     IOT_SOCKETCLOSEOPT_FORCE_DISCONNECT     = 0x1,  <span class="comment">// If the Socket is a shared socket then the flag</span></div><div class="line">                                                     <span class="comment">// will disconnect the shared connection.</span></div><div class="line">                                                     <span class="comment">// The shared connection will remain connected until there are no users</span></div><div class="line">                                                     <span class="comment">// who currently have the shared socket open.</span></div><div class="line"> </div><div class="line">      IOT_SOCKETCLOSEOPT_MAX                 = 0x2  <span class="comment">// Maximum bit value of the enum</span></div><div class="line">} IotSocketCloseFlags_t;</div></div><!-- fragment --><h1><a class="anchor" id="aws_iot_sdk_section_5"></a>
Build Artifacts</h1>
<p>Shared Library name: libaws_iot_sdk</p>
<h1><a class="anchor" id="aws_iot_sdk_section_6"></a>
Debugging into Logs</h1>
<p>Please refer - <a href="https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/logging/index.html">https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/logging/index.html</a> for details</p>
<h1><a class="anchor" id="aws_iot_sdk_section_7"></a>
FAQ</h1>
<ul>
<li>Does it support communication over protocols other than mqtt? <blockquote class="doxtable">
<p>The library currently supports only mqtt protocol. </p>
</blockquote>
</li>
<li>Can you connect and communicate to any other mqtt server endpoint other than AWS_IOT server endpoint? <blockquote class="doxtable">
<p>Yes, it is possible to use the library to communicate with some other mqtt server with necessary changes to the library. </p>
</blockquote>
</li>
<li>Can we pass in connection parameters like certificates, keys, etc while provisioning the connection? <blockquote class="doxtable">
<p>Yes, the user can pass its own connection parameters like certificates while opening a new connection by setting the Socket flag as IOT_SOCKETOPT_PROVISION while calling the IotSocket_Open API. Otherwise the user can also use the certificates that are added statically in the code while it is provisioned for the first time. </p>
</blockquote>
</li>
<li>If the server gets unexpectedly disconnected due to internal or external reasons like fluctuations in wifi connectivity, Will it try to reconnect to the server ? <blockquote class="doxtable">
<p>This functionality is planned to be added to the next release version of the ACS distribution of AWS IoT SDK library. Currently, this functionality is not supported. </p>
</blockquote>
</li>
</ul>
<h1><a class="anchor" id="aws_iot_sdk_section_8"></a>
References</h1>
<ul>
<li>https://docs.aws.amazon.com/freertos/latest/lib-ref/c-sdk/main/index.html</li>
<li>https://github.com/aws/aws-iot-device-sdk-embedded-C </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
