<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACS: Device Hardware Authentication (DHA)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACS
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__ACS__HAL__DHAV2.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Device Hardware Authentication (DHA)<div class="ingroups"><a class="el" href="group__HAL.html">HAL</a> &raquo; <a class="el" href="group__HAL__API.html">API Definitions</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>HAL API for device authentication.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Device Hardware Authentication (DHA):</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__ACS__HAL__DHAV2.png" border="0" alt="" usemap="#group____ACS____HAL____DHAV2"/>
<map name="group____ACS____HAL____DHAV2" id="group____ACS____HAL____DHAV2">
<area shape="rect" id="node1" href="group__HAL__API.html" title="ACE Hardware and Platform Abstraction Interfaces. " alt="" coords="5,13,116,39"/>
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gae2387897e6de1fab151881f056239586"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="group__ACS__HAL__DHAV2.html#ga08fff25df2a80eb634d488ee99116fec">aceDhaHal_fields</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#gae2387897e6de1fab151881f056239586">aceDhaHal_fields_t</a></td></tr>
<tr class="separator:gae2387897e6de1fab151881f056239586"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga08fff25df2a80eb634d488ee99116fec"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga08fff25df2a80eb634d488ee99116fec">aceDhaHal_fields</a> { <br />
&#160;&#160;<a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca7d3043ddc418b3864a9f8a0667960aa9">ACE_DHA_SOC_ID</a> = 0x01, 
<a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca3d480f066d229fbbab416be0a50f57a8">ACE_DHA_DSN</a> = 0x101, 
<a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca48021ceee9bcdcdcb68e7c8d65a769ff">ACE_DHA_CSR</a> = 0x201, 
<a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca91ffd1aff684fdaa77b2411b25f97119">ACE_DHA_CERTIFICATE_CHAIN</a>, 
<br />
&#160;&#160;<a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca21303854d7a5542431849fe9eb3550d0">ACE_DHA_LEAF_CERTIFICATE</a>
<br />
 }</td></tr>
<tr class="separator:ga08fff25df2a80eb634d488ee99116fec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga89caae9d8f8f8bbbea71d6e4f49c5934"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga89caae9d8f8f8bbbea71d6e4f49c5934">aceDhaHal_open</a> (void)</td></tr>
<tr class="memdesc:ga89caae9d8f8f8bbbea71d6e4f49c5934"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open (init) the DHA HAL.  <a href="#ga89caae9d8f8f8bbbea71d6e4f49c5934">More...</a><br /></td></tr>
<tr class="separator:ga89caae9d8f8f8bbbea71d6e4f49c5934"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16b6005919d8a441bdd684edb6ef8851"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga16b6005919d8a441bdd684edb6ef8851">aceDhaHal_generateKey</a> (void)</td></tr>
<tr class="memdesc:ga16b6005919d8a441bdd684edb6ef8851"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a DHA key-pair.  <a href="#ga16b6005919d8a441bdd684edb6ef8851">More...</a><br /></td></tr>
<tr class="separator:ga16b6005919d8a441bdd684edb6ef8851"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga465da4898f2ce16701cd7d507bc08954"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga465da4898f2ce16701cd7d507bc08954">aceDhaHal_getPublicKey</a> (uint8_t **x509_data, size_t *x509_data_len)</td></tr>
<tr class="memdesc:ga465da4898f2ce16701cd7d507bc08954"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the DHA public key.  <a href="#ga465da4898f2ce16701cd7d507bc08954">More...</a><br /></td></tr>
<tr class="separator:ga465da4898f2ce16701cd7d507bc08954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2b1b7782c76fc5aaed89729ed30cea0b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga2b1b7782c76fc5aaed89729ed30cea0b">aceDhaHal_signData</a> (const uint8_t *data, const size_t data_len, uint8_t **signed_data, size_t *signed_data_len)</td></tr>
<tr class="memdesc:ga2b1b7782c76fc5aaed89729ed30cea0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signs a SHA256 digest using the DHA private key and returns the signature and its length.  <a href="#ga2b1b7782c76fc5aaed89729ed30cea0b">More...</a><br /></td></tr>
<tr class="separator:ga2b1b7782c76fc5aaed89729ed30cea0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4710be0a78caa2deb1bced4a4b5ef0de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga4710be0a78caa2deb1bced4a4b5ef0de">aceDhaHal_verifyData</a> (const uint8_t *data, const size_t data_len, const uint8_t *signature, const size_t signature_len)</td></tr>
<tr class="memdesc:ga4710be0a78caa2deb1bced4a4b5ef0de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifies a SHA256 digest using the DHA public key given the corresponding signature.  <a href="#ga4710be0a78caa2deb1bced4a4b5ef0de">More...</a><br /></td></tr>
<tr class="separator:ga4710be0a78caa2deb1bced4a4b5ef0de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7ddc1484977507cb7873fc7a2b75872d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga7ddc1484977507cb7873fc7a2b75872d">aceDhaHal_getField</a> (int type, void **input, size_t *size)</td></tr>
<tr class="memdesc:ga7ddc1484977507cb7873fc7a2b75872d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves additional DHA fields.  <a href="#ga7ddc1484977507cb7873fc7a2b75872d">More...</a><br /></td></tr>
<tr class="separator:ga7ddc1484977507cb7873fc7a2b75872d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7e9d46fc871f552e551e3fb955723a65"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#ga7e9d46fc871f552e551e3fb955723a65">aceDhaHal_setCertificate</a> (const char *certificate)</td></tr>
<tr class="memdesc:ga7e9d46fc871f552e551e3fb955723a65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the DHAv2 certificate chain of the device.  <a href="#ga7e9d46fc871f552e551e3fb955723a65">More...</a><br /></td></tr>
<tr class="separator:ga7e9d46fc871f552e551e3fb955723a65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa6c1a0cb316e414d1a02d76907cb8dec"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ACS__HAL__DHAV2.html#gaa6c1a0cb316e414d1a02d76907cb8dec">aceDhaHal_close</a> (void)</td></tr>
<tr class="memdesc:gaa6c1a0cb316e414d1a02d76907cb8dec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close (de-init) the DHA HAL Close MUST be called when exiting HAL API.  <a href="#gaa6c1a0cb316e414d1a02d76907cb8dec">More...</a><br /></td></tr>
<tr class="separator:gaa6c1a0cb316e414d1a02d76907cb8dec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>HAL API for device authentication. </p>
<p>Device Hardware Authentication APIs are set of APIs to provide device authentication services mainly are:</p><ul>
<li>key generation</li>
<li>signing of a blob of data</li>
<li>verifying/authenticating a blob of data using the key</li>
<li>return a public key</li>
</ul>
<p>Steps to setup and use the DHA HAL interface: <a class="el" href="group__ACS__HAL__DHAV2.html#ga89caae9d8f8f8bbbea71d6e4f49c5934" title="Open (init) the DHA HAL. ">aceDhaHal_open()</a> needs to be called first to ensure APIs are ready for use. </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="gae2387897e6de1fab151881f056239586"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae2387897e6de1fab151881f056239586">&#9670;&nbsp;</a></span>aceDhaHal_fields_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="group__ACS__HAL__DHAV2.html#ga08fff25df2a80eb634d488ee99116fec">aceDhaHal_fields</a>  <a class="el" href="group__ACS__HAL__DHAV2.html#gae2387897e6de1fab151881f056239586">aceDhaHal_fields_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum used to specify the field types </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga08fff25df2a80eb634d488ee99116fec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga08fff25df2a80eb634d488ee99116fec">&#9670;&nbsp;</a></span>aceDhaHal_fields</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__ACS__HAL__DHAV2.html#ga08fff25df2a80eb634d488ee99116fec">aceDhaHal_fields</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum used to specify the field types </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga08fff25df2a80eb634d488ee99116feca7d3043ddc418b3864a9f8a0667960aa9"></a>ACE_DHA_SOC_ID&#160;</td><td class="fielddoc"><p>Hardware identifier. </p>
<p>Hexadecimal string containing a hardware identifier of the device. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga08fff25df2a80eb634d488ee99116feca3d480f066d229fbbab416be0a50f57a8"></a>ACE_DHA_DSN&#160;</td><td class="fielddoc"><p>Amazon-only identifier. </p>
<p>Device Serial Number (DSN) of the device as an ASCII string. Not applicable to devices not manufactured by Amazon. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga08fff25df2a80eb634d488ee99116feca48021ceee9bcdcdcb68e7c8d65a769ff"></a>ACE_DHA_CSR&#160;</td><td class="fielddoc"><p>Certificate Signing Request (CSR) generated by the device. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga08fff25df2a80eb634d488ee99116feca91ffd1aff684fdaa77b2411b25f97119"></a>ACE_DHA_CERTIFICATE_CHAIN&#160;</td><td class="fielddoc"><p>Complete certificate chain (each certificate in PEM format) of the device. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga08fff25df2a80eb634d488ee99116feca21303854d7a5542431849fe9eb3550d0"></a>ACE_DHA_LEAF_CERTIFICATE&#160;</td><td class="fielddoc"><p>Leaf certificate (PEM format) of the complete certificate chain of the device. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaa6c1a0cb316e414d1a02d76907cb8dec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa6c1a0cb316e414d1a02d76907cb8dec">&#9670;&nbsp;</a></span>aceDhaHal_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> aceDhaHal_close </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close (de-init) the DHA HAL Close MUST be called when exiting HAL API. </p>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
<a id="ga16b6005919d8a441bdd684edb6ef8851"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga16b6005919d8a441bdd684edb6ef8851">&#9670;&nbsp;</a></span>aceDhaHal_generateKey()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aceDhaHal_generateKey </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a DHA key-pair. </p>
<p>This tells the platform-specific module to generate an asymmetric key-pair pair to be used as the DHA key-pair. For DHAv2, the key parameters will be an Elliptic Curve (EC) 256-bit key over the prime256v1 curve (aka NIST P-256, secp256r1).</p>
<p>If the DHA key already exists on the device, the key-pair will not be created again and this call SHOULD fail. There is no DHA API to delete the current key on device.</p>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
<a id="ga7ddc1484977507cb7873fc7a2b75872d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7ddc1484977507cb7873fc7a2b75872d">&#9670;&nbsp;</a></span>aceDhaHal_getField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aceDhaHal_getField </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves additional DHA fields. </p>
<p>DHA module maintains different meta-data related to its operation. If the enum is applicable, the module should allocate memory for the data and pass it back to the caller, otherwise it shall return an error. It is the caller's responsibility to properly free the data afterwards. Below is the list of enums the DHA module shall support:</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">type</td><td>- specify the field type</td></tr>
  </table>
  </dd>
</dl>
<p><a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca7d3043ddc418b3864a9f8a0667960aa9">ACE_DHA_SOC_ID</a></p>
<p><a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca3d480f066d229fbbab416be0a50f57a8">ACE_DHA_DSN</a></p>
<p>Devices not manufactured by Amazon should return an error.</p>
<p><a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca48021ceee9bcdcdcb68e7c8d65a769ff">ACE_DHA_CSR</a></p>
<p>Distinguished Name (DN) of the CSR should have the following OIDs embedded:</p>
<p><code>1.3.6.1.4.1.4843.1.1</code> - Device Serial Number (DSN) of the device. Omit if devices not manufactured by Amazon.</p>
<p><code>1.3.6.1.4.1.4843.1.2</code> - Optional: Hexadecimal string containing a hardware identifier of the device. Omit the field if not supported by hardware.</p>
<p><code>1.3.6.1.4.1.4843.1.3</code> - Device Type ID for the particular device.</p>
<p>Sample CSR is provided below:</p>
<pre class="fragment">-----BEGIN CERTIFICATE REQUEST-----
MIIBOTCB4QIBADBhMR8wHQYJKwYBBAGlawEBDBBHWFgwVFNQMUg0V0tQMkhKMR8w
HQYJKwYBBAGlawECDBAwMDAwMDAwMGQ0YzM3MGRjMR0wGwYJKwYBBAGlawEDDA5B
MlVNSUhNVkRFUEJQRzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABLIgXnJQpM5K
1mEzmKpxrXPZiLuJIIVIV/tUuaJYfJA5z9rQnc7VSD6LQxwwcV+DhJpops8NQSRB
2F0N2pBerBmgHjAcBgkqhkiG9w0BCQ4xDzANMAsGA1UdDwQEAwIHgDAKBggqhkjO
PQQDAgNHADBEAiB0iiinV6mShYpj2QQ/MWaJMFjOa/0IFEJU/qj4wDy9CgIgVxoO
PKTzhDCRs+P6GGGbsEr/d2Bfq3MTFSLL82TZHY0=
-----END CERTIFICATE REQUEST-----
</pre><p><a class="el" href="group__ACS__HAL__DHAV2.html#gga08fff25df2a80eb634d488ee99116feca91ffd1aff684fdaa77b2411b25f97119">ACE_DHA_CERTIFICATE_CHAIN</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">input</td><td>Pointer to data allocated by DHA API to return the requested meta-data</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">size</td><td>Pointer to length of requested meta-data to be set by DHA API</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
<a id="ga465da4898f2ce16701cd7d507bc08954"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga465da4898f2ce16701cd7d507bc08954">&#9670;&nbsp;</a></span>aceDhaHal_getPublicKey()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aceDhaHal_getPublicKey </td>
          <td>(</td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>x509_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>x509_data_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the DHA public key. </p>
<p>This returns the DHA public key to the caller.</p>
<p>Below are the data format of the retrieved DHA public key depending on the key algorithm used.</p>
<p>EC: DER-encoded data in SubjectPublicKeyInfo format (RFC5480), with curve parameters specified as a nameCurve object identifier (e.g. 1.2.840.10045.3.1.7 for ptime256v1)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">x509_data</td><td>Pointer to data allocated by the HAL implementation to return the DER-encoded DHA public key</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">x509_data_len</td><td>Pointer to length of public key to be set by the HAL implementation</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
<a id="ga89caae9d8f8f8bbbea71d6e4f49c5934"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga89caae9d8f8f8bbbea71d6e4f49c5934">&#9670;&nbsp;</a></span>aceDhaHal_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> aceDhaHal_open </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open (init) the DHA HAL. </p>
<p>Open MUST be called before using any HAL API.</p>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
<a id="ga7e9d46fc871f552e551e3fb955723a65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7e9d46fc871f552e551e3fb955723a65">&#9670;&nbsp;</a></span>aceDhaHal_setCertificate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aceDhaHal_setCertificate </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>certificate</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the DHAv2 certificate chain of the device. </p>
<p>This API will perform checks on the certificate chain before storing it:</p>
<ul>
<li>Public key in the leaf certificate needs to match the one on device</li>
<li>Meta-data such as DSN (Applicable to Amazon devices only) also needs to match the one on device</li>
<li>The input certificate chain must verify up to the Amazon-owned DHAv2 Root CA</li>
</ul>
<p>Amazon's DHAv2 Root CA is provided below:</p>
<pre class="fragment">-----BEGIN CERTIFICATE-----
MIIDNjCCAtugAwIBAgIJAKpBxYNyH8biMAoGCCqGSM49BAMCMIGUMRQwEgYDVQQK
DAtBbWF6b24gSW5jLjEjMCEGA1UECwwaRGV2aWNlIE1hbmFnZW1lbnQgU2Vydmlj
ZXMxEDAOBgNVBAcMB1NlYXR0bGUxEzARBgNVBAgMCldhc2hpbmd0b24xCzAJBgNV
BAYTAlVTMSMwIQYDVQQDDBpBbWF6b25ESEEgUm9vdCBDZXJ0aWZpY2F0ZTAgFw0x
NzExMTYwNjI3MDlaGA8yMTE3MTEwODA2MjcwOVowgZQxFDASBgNVBAoMC0FtYXpv
biBJbmMuMSMwIQYDVQQLDBpEZXZpY2UgTWFuYWdlbWVudCBTZXJ2aWNlczEQMA4G
A1UEBwwHU2VhdHRsZTETMBEGA1UECAwKV2FzaGluZ3RvbjELMAkGA1UEBhMCVVMx
IzAhBgNVBAMMGkFtYXpvbkRIQSBSb290IENlcnRpZmljYXRlMFkwEwYHKoZIzj0C
AQYIKoZIzj0DAQcDQgAEv7+Zfvkc+qvUaKgaGxQMZoDFHQ18Z5OSXB4BNkYRszgR
PQ82o54KVb0RKkkq0e3niRn1gUZ8jozePEPrpPV5yaOCARAwggEMMA8GA1UdEwEB
/wQFMAMBAf8wHQYDVR0OBBYEFGGL3E8kSqVu7gplvLx0mlGV6qtgMIHJBgNVHSME
gcEwgb6AFGGL3E8kSqVu7gplvLx0mlGV6qtgoYGapIGXMIGUMRQwEgYDVQQKDAtB
bWF6b24gSW5jLjEjMCEGA1UECwwaRGV2aWNlIE1hbmFnZW1lbnQgU2VydmljZXMx
EDAOBgNVBAcMB1NlYXR0bGUxEzARBgNVBAgMCldhc2hpbmd0b24xCzAJBgNVBAYT
AlVTMSMwIQYDVQQDDBpBbWF6b25ESEEgUm9vdCBDZXJ0aWZpY2F0ZYIJAKpBxYNy
H8biMA4GA1UdDwEB/wQEAwIBhjAKBggqhkjOPQQDAgNJADBGAiEAoCM4t1cMuTeu
8yIlw/1BUIUb1Q4MYXp+LyfjcbmVz8ECIQDuKW8gQZjUS8Z7GcgNYnFup3UjTznj
5ja4/PmvDx0Glw==
-----END CERTIFICATE-----
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">certificate</td><td>Pointer to certificate chain with PEM-encoded certificates</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
<a id="ga2b1b7782c76fc5aaed89729ed30cea0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2b1b7782c76fc5aaed89729ed30cea0b">&#9670;&nbsp;</a></span>aceDhaHal_signData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aceDhaHal_signData </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>data_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>signed_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>signed_data_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Signs a SHA256 digest using the DHA private key and returns the signature and its length. </p>
<p>The input data is assumed to be a SHA256 digest. DHA APIs contract assumes that it is the caller's responsibility to hash the input data using SHA256 before passing to the HAL implementation. Input data lengths not equal to a SHA256 digest will result in failure. Current signature scheme is ECDSA.</p>
<dl class="section note"><dt>Note</dt><dd>Length of the signature data is not a fixed number. For ECDSA, signature data is a DER-encoded array of 2 large unsigned integers r and s. Callers should not assume a fixed length and must use the size returned in signed_data_len.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Pointer to SHA256 digest input</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_len</td><td>Length of input data</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">signed_data</td><td>Pointer to data allocated by the HAL implementation to return the signature</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">signed_data_len</td><td>Pointer to length of signature to be set by DHA API implementation</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
<a id="ga4710be0a78caa2deb1bced4a4b5ef0de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4710be0a78caa2deb1bced4a4b5ef0de">&#9670;&nbsp;</a></span>aceDhaHal_verifyData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int aceDhaHal_verifyData </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>data_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>signature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>signature_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifies a SHA256 digest using the DHA public key given the corresponding signature. </p>
<p>The input data is assumed to be a SHA256 digest. DHA APIs assume that it is the caller's responsibility to hash the input data using SHA256 before passing to the HAL implementation. Input data lengths not equal to a SHA256 digest will result in failure. Current signature scheme is ECDSA.</p>
<p>DHAv2: ECDSA with SHA256 as the hash algorithm</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Pointer to SHA256 digest input</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_len</td><td>Length of input data</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">signature</td><td>Pointer to signature data</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">signature_len</td><td>Length of signature data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ACE_STATUS_OK on success, and a negative value from <a class="el" href="ace__status_8h.html#aacd7ede39583d4c0553059d25ba05082">ace_status_t</a> otherwise </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
